{"definitions":{},"info":{"contact":{"email":"support@migrx.ru","responsibleOrganization":"migrx"},"description":"API for Core cluster","title":"Gateway cluster API","version":"2.0.0"},"paths":{"/api/v1/auth":{"post":{"consumes":["application/json"],"description":"Auth to cluster<br/>","parameters":[{"description":"Auth data username and password","in":"body","name":"request","required":true,"schema":{"example":{"password":"password","username":"user"},"properties":{"password":{"description":"User password","type":"string"},"username":{"description":"User login","type":"string"}}}}],"produces":["application/json"],"responses":{"200":{"description":"Auth data with token and session","schema":{"example":{"access_token":"base64 jwt token"},"properties":{"access_token":{"description":"JWT Token","type":"string"}}}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Auth to cluster","tags":["Auth"]}},"/api/v1/cluster":{"get":{"description":"Get clusters list<br/>","produces":["application/json"],"responses":{"200":{"description":"Clusters list","schema":{"example":[{"cluster":"main","vip_host":{"ip":"10.1.128.162","uuid":"b18462fa-d089-41fc-a4da-4138e14aba0a","vip":"10.1.128.195"}}],"items":{"properties":{"cluster":{"description":"Cluster name","type":"string"},"vip_host":{"properties":{"ip":{"description":"Node IP","type":"string"},"uuid":{"description":"Node UUID","type":"string"},"vip":{"description":"Cluster VIP","type":"string"}},"type":"object"}},"type":"object"},"type":"array"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get clusters list","tags":["Cluster"]}},"/api/v1/cluster/freenodes":{"delete":{"description":"Delete free node list<br/>","produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Delete free node list","tags":["Cluster"]},"get":{"description":"Get free nodes list<br/>","produces":["application/json"],"responses":{"200":{"description":"Free node list","schema":{"additionalProperties":true,"example":[{"hostname":"localhost","ip":"127.0.0.1","uid":1,"uuid":"bb486ffe-25ac-46c0-8db8-d09029fbdc20"}],"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get free nodes list","tags":["Cluster"]}},"/api/v1/cluster/metrics":{"get":{"description":"Get metrics<br/>","produces":["application/json"],"responses":{"200":{"description":"Clusters prometeus metrics","schema":null},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get metrics","tags":["Metrics"]}},"/api/v1/cluster/repo":{"get":{"description":"Get plugin list<br/>","produces":["application/json"],"responses":{"200":{"description":"Avaliable plugin list","schema":{"additionalProperties":true,"example":{"plugins":["mgx-plgn-aaa","mgx-plgn-aaaevents","mgx-plgn-cassandra","mgx-plgn-storage-libvirt"]},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get plugin list","tags":["Plugin"]}},"/api/v1/cluster/{name}":{"delete":{"consumes":["application/json"],"description":"Delete Cluster<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Delete Cluster","tags":["Cluster"]},"post":{"consumes":["application/json"],"description":"Create new Cluster<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Cluster info","in":"body","name":"request","required":true,"schema":{"example":{"node_ids":["1","2","3"],"vip":"192.168.1.100"},"properties":{"node_ids":{"items":{"description":"Node IDs","type":"string"},"type":"array"},"vip":{"description":"New VIP addres","type":"string"}}}}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Create new Cluster","tags":["Cluster"]}},"/api/v1/cluster/{name}/node":{"put":{"consumes":["application/json"],"description":"Modify Cluster node<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Node data","in":"body","name":"request","required":true,"schema":{"example":{"node_id":"1","op":"add|del|start|stop"},"properties":{"node_id":{"description":"Node ID","type":"string"},"op":{"description":"Node operation","type":"string"}}}}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Modify Cluster node","tags":["Cluster"]}},"/api/v1/cluster/{name}/nodes":{"get":{"description":"Get clusters node list<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Cluster node list","schema":{"example":[{"cluster":"main2","created":"2022-10-14 15:13:25","hostname":"localhost","ip":"127.0.0.1","node":"bb486ffe-25ac-46c0-8db8-d09029fbdc20@127.0.0.1","serv_conf":null,"status":"UP","uid":1,"uuid":"bb486ffe-25ac-46c0-8db8-d09029fbdc20"}],"items":{"properties":{"cluster":{"description":"Cluster name","type":"string"},"created":{"description":"Last update","type":"string"},"hostname":{"description":"Node hostname","type":"string"},"ip":{"description":"Node IP","type":"string"},"node":{"description":"Node name","type":"string"},"serv_conf":{"description":"Services","type":"string"},"status":{"description":"Node status","type":"string"},"uid":{"description":"Node ID","type":"string"},"uuid":{"description":"Node UUID","type":"string"}},"type":"object"},"type":"array"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get clusters node list","tags":["Cluster"]}},"/api/v1/cluster/{name}/plugins":{"get":{"description":"Get clusters plugin list<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Cluster plugin list","schema":{"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":["mgx-plgn-cmd-exec"]},"items":{"properties":{"description":"plugin name","type":"string"},"type":"object"},"type":"array"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get clusters plugin list","tags":["Plugin"]}},"/api/v1/cluster/{name}/plugins/{plugin}":{"delete":{"description":"Stop plugin<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Cluster plugin name","in":"path","name":"plugin","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Stop plugin","tags":["Plugin"]},"get":{"description":"Get plugin desc<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Cluster plugin name","in":"path","name":"plugin","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":{"active":1,"name":"mgx-plgn-cmd-exec","priority":0}},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get plugin desc","tags":["Plugin"]},"post":{"description":"Start plugin<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Cluster plugin name","in":"path","name":"plugin","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Start plugin","tags":["Plugin"]},"put":{"consumes":["application/json"],"description":"Call cluster plugin<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Plugin name","in":"path","name":"plugin","required":true},{"description":"Call across all nodes [y|n]","in":"query","name":"all","required":false},{"description":"Request","in":"body","name":"request","required":true,"schema":{"additionalProperties":true,"example":{"context":{"op":"add"},"data":{"response":"data"}},"type":"object"}}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"response":"data"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Call cluster plugin","tags":["Plugin"]}},"/api/v1/cluster/{name}/repo/plugins":{"get":{"description":"Get clusters plugin list<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Cluster plugin list","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":{"plugins":["mgx-plgn-storage-libvirt-2.0.2-1","mgx-plgn-podman-2.0.2-1","mgx-plgn-check-status-2.0.0-1","mgx-plgn-faucet-2.0.0-1"]}},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get clusters plugin list","tags":["Plugin"]}},"/api/v1/cluster/{name}/repo/plugins/{plugin}":{"delete":{"description":"Plugin uninstall<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Plugin name","in":"path","name":"plugin","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":{"status":"ok"}},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Plugin uninstall","tags":["Plugin"]},"post":{"description":"Plugin install<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Plugin name","in":"path","name":"plugin","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":{"status":"ok"}},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Plugin install","tags":["Plugin"]}},"/api/v1/cluster/{name}/service/{service}":{"delete":{"description":"Stop service<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Cluster service name","in":"path","name":"service","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Stop service","tags":["Service"]},"get":{"description":"Get service status<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Cluster service name","in":"path","name":"service","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":{"status":"ok"}},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get service status","tags":["Service"]},"post":{"description":"Start service<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Cluster service name","in":"path","name":"service","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Start service","tags":["Service"]},"put":{"description":"Update service conf<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"Cluster service name","in":"path","name":"service","required":true},{"description":"Service conf","in":"body","name":"request","required":true,"schema":{"additionalProperties":true,"example":{"check":"no","code":"0"},"type":"object"}}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Update service conf","tags":["Service"]}},"/api/v1/cluster/{name}/version":{"get":{"description":"Get cluster version<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true}],"produces":["application/json"],"responses":{"200":{"description":"Cluster version","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":{"all":"29377456012b1596b028d78345ec1c0b152ae006","rpm":"4e1243bd22c66e76c2ba9eddc1f91394e57f9f83","spec_ver":"9054fbe0b622c638224d50d20824d2ff6782e308"}},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Get cluster version","tags":["Cluster"]}},"/api/v1/cluster/{name}/vip":{"post":{"consumes":["application/json"],"description":"Change Cluster Service<br/>","parameters":[{"description":"Cluster name","in":"path","name":"name","required":true},{"description":"New VIP address","in":"body","name":"request","required":true,"schema":{"example":{"vip":"192.168.1.100"},"properties":{"vip":{"description":"New VIP address","type":"string"}}}}],"produces":["application/json"],"responses":{"200":{"description":"Success","schema":{"additionalProperties":true,"example":{"bb486ffe-25ac-46c0-8db8-d09029fbdc20":"ok"},"type":"object"}},"500":{"description":"Error response","schema":{"example":{"error":"Error occured"},"properties":{"error":{"description":"Error message","type":"string"}}}}},"summary":"Change Cluster service","tags":["Cluster"]}}},"schemes":["http","https"],"swagger":"2.0"}
